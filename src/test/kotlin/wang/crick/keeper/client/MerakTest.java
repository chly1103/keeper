package wang.crick.keeper.client;

import com.alibaba.fastjson.JSONObject;
import org.junit.Test;
import org.springframework.web.client.RestTemplate;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class MerakTest {

    @Test
    public void t1() throws IOException {

        RestTemplate restTemplate = new RestTemplate();

        List<String> list = Arrays.asList(
                "1.3.12.2.1107.5.1.4.64606.30000016033105593612400229149",
                "1.3.12.2.1107.5.1.4.64606.30000016033105593612400228592",
                "1.3.12.2.1107.5.1.4.64606.30000016033105593612400228891",
                "1.3.12.2.1107.5.1.4.64606.30000016033105593612400229757",
                "1.3.12.2.1107.5.1.4.64606.30000016033105593612400230364",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100000304",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100000593",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100000856",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100001413",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100005535",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100001980",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100002494",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100002194",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100003282",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100004440",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100003024",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100002807",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100008499",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100009633",
                "1.3.12.2.1107.5.1.4.64606.30000016071806122035100009353",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100005212",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100000000",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100008258",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100000289",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100000539",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100001362",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100010505",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100000829",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100001959",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100001669",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100002240",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100003995",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100003733",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100007366",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100005937",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100001073",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100004608",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100002824",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100007941",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100003417",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100007638",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100009591",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100002531",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100004928",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100004289",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100006778",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100003136",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100009306",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100007085",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100006200",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100005443",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100008553",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100006458",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100009886",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100010166",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100008794",
                "1.3.12.2.1107.5.1.4.64606.30000016071906124502100009025",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300000000",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300000295",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300000579",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300000883",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300001208",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300003098",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300001565",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300001896",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300004913",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300003720",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300002814",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300002212",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300002515",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300005385",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300006318",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300003400",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300006609",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300004593",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300003997",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300004300",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300005697",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300006037",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300006921",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300007219",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300007509",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300008107",
                "1.3.12.2.1107.5.1.4.64606.30000016072006045818300007803",
                "1.2.392.200036.9116.2.5.1.48.1223894863.1468978092.4921",
                "1.2.392.200036.9116.2.5.1.48.1223894863.1468989625.4850",
                "1.2.392.200036.9116.2.5.1.48.1223894863.1468988499.1577",
                "1.2.392.200036.9116.2.5.1.48.1223894863.1468987913.4169",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000002249",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000004978",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000000266",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000000000",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000000537",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000000787",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000001679",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000001067",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000001955",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000001376",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000002520",
                "1.3.12.2.1107.5.1.4.64606.30000016072106211763000004707"
        )
                .stream()
                .flatMap(it -> {
                    try {
//                        JSONObject resp = restTemplate.getForObject("http://merak.kakapo.yitu-med.info/api/v1.0.3/batch/anno/series/" + it + "/instance", JSONObject.class);
                        JSONObject resp = restTemplate.getForObject("http://backup-merak.bgprod.yitu-med.info/api/v1.0.3/batch/anno/series/" + it + "/instance", JSONObject.class);
                        return resp.getJSONArray("data")
                                .stream()
                                .map(json -> JSONObject.parseObject(JSONObject.toJSONString(json)))
                                .map(json -> json.getString("instanceId"));
                    }catch (Exception e) {
                        return Stream.empty();
                    }

                }).collect(Collectors.toList());

        Files.write(Paths.get(".tmp"), list);
    }
}
